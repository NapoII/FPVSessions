<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ session.name }} - {{ session.sub }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Full-page loading overlay */
        #loadingOverlay {
            position: fixed;
            inset: 0;
            background: rgba(2, 6, 23, 0.6);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity .3s ease, visibility .3s ease;
        }
        #loadingOverlay.hidden {
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        /* Dark background */
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #0b1220 100%);
            color: #e5eefb;
        }
        h2, h5 { color: #eaf2ff; }
        .text-muted { color: #9fb3d1 !important; }

        /* Media */
        .media-thumb {
            max-width: 100%;
            max-height: 320px;
            border-radius: 12px;
            margin-bottom: 1rem;
            background: #000;
            border: 1px solid rgba(255,255,255,0.12);
        }

        /* Lists */
        .file-list { font-size: 0.98em; }
        .list-group { --bs-list-group-bg: transparent; }
        .list-group-item {
            background: rgba(255,255,255,0.04);
            color: #e5eefb;
            border-color: rgba(255,255,255,0.10);
        }

        /* Links and inputs */
        .back-link { text-decoration: none; color: #8ab4ff; }
        .back-link:hover { text-decoration: underline; color: #b3d3ff; }
        .tag-pill { margin: 2px; }
    /* Top-right logout button */
    .top-logout { position: fixed; top: 12px; right: 12px; z-index: 12000; }
    .top-logout .btn { background: rgba(255,255,255,0.04); color: #e5eefb; border: 1px solid rgba(255,255,255,0.06); }
        .input-group-text {
            background: rgba(255,255,255,0.06);
            color: #cfe3ff;
            border-color: rgba(255,255,255,0.14);
        }
        .form-control {
            background: rgba(255,255,255,0.06);
            color: #e5eefb;
            border-color: rgba(255,255,255,0.14);
        }
        .form-control::placeholder { color: rgba(229,238,251,0.55); }
        .btn-outline-primary {
            color: #93c5fd;
            border-color: #60a5fa;
        }
        .btn-outline-primary:hover {
            background: rgba(37, 99, 235, 0.25);
            color: #dbeafe;
            border-color: #93c5fd;
        }

        /* Dark liquid glass container */
        .liquid-glass {
            /* slightly more transparent */
            background: rgba(17, 25, 40, 0.48);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 10px 30px rgba(2, 8, 23, 0.6);
            backdrop-filter: blur(14px) saturate(140%);
            -webkit-backdrop-filter: blur(14px) saturate(140%);
            padding: 32px 24px;
            margin-top: 24px;
        }
                /* Icon-only stats bar */
                .stats-mini { max-width: 560px; margin: 0 auto 12px auto; }
                .stats-mini .icon { font-size: 1.05rem; color: #dbeafe; }
                .stats-mini .badge { background: rgba(255,255,255,0.08); color: #e5eefb; border: 1px solid rgba(255,255,255,0.18); }

                /* Gallery converted to card-grid to match main page session cards */
                .tcg-card {
                    position: relative;
                    overflow: hidden;
                    border-radius: 12px;
                    background: radial-gradient(800px 300px at 10% 10%, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
                    border: 1px solid rgba(255,255,255,0.06);
                    box-shadow: 0 10px 26px rgba(2, 8, 23, 0.45), inset 0 0 0 1px rgba(255,255,255,0.03);
                }
                .tcg-card:before {
                    content: "";
                    position: absolute;
                    top: -40%; left: -40%;
                    width: 180%; height: 180%;
                    background: conic-gradient(from 0deg, rgba(255,255,255,0.06), rgba(14,165,233,0.08), rgba(168,85,247,0.06));
                    filter: blur(18px);
                    transform: rotate(0deg);
                    transition: transform .6s ease;
                    pointer-events: none;
                    z-index: 0;
                }
                .tcg-card:hover:before { transform: rotate(12deg); }
                .tcg-header { position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.35); color: #eaf2ff; padding: .25rem .5rem; font-size: .75rem; border-radius: .4rem; z-index:3; }

                .session-grid {
                    display: grid;
                    grid-template-columns: repeat(1, 1fr);
                    gap: 12px;
                    align-items: start;
                }
                @media (min-width: 576px) { .session-grid { grid-template-columns: repeat(2, 1fr); } }
                @media (min-width: 768px) { .session-grid { grid-template-columns: repeat(3, 1fr); } }
                @media (min-width: 992px) { .session-grid { grid-template-columns: repeat(4, 1fr); } }

                .image-card { width: 100%; }
                .image-thumb { width: 100%; height: 160px; object-fit: cover; display:block; border-top-left-radius: 12px; border-top-right-radius: 12px; position: relative; z-index: 1; }
                .image-card .card-body { padding: .75rem; text-align:center; }

                .lightbox-overlay { position: fixed; inset:0; background: rgba(2,6,23,0.9); display:flex; align-items:center; justify-content:center; z-index:20000; }
                .lightbox-img { max-width: 92%; max-height: 92%; border-radius: 8px; box-shadow: 0 30px 80px rgba(0,0,0,0.6); cursor: zoom-out; }
    </style>
</head>
<body>
    <div id="loadingOverlay" aria-live="polite" aria-busy="true" style="display: none !important; opacity: 0 !important; visibility: hidden !important;">
        <div class="text-center">
            <div class="spinner-border text-info" style="width:3rem;height:3rem" role="status">
                <span class="visually-hidden">Loading…</span>
            </div>
            <div class="mt-2 text-light small">Loading session…</div>
            <div class="mt-2">
                <div class="progress" style="width: 200px; height: 6px; margin: 0 auto;">
                    <div id="progressBar" class="progress-bar bg-info" role="progressbar" style="width: 0%"></div>
                </div>
                <div id="progressText" class="text-light small mt-1">0%</div>
            </div>
        </div>
    </div>
        <!-- Top-right Logout Button -->
        <div class="top-logout">
            <a href="/" class="btn btn-sm me-1" aria-label="Home"><i class="fa-solid fa-house"></i></a>
            {% if is_admin %}
            <a href="{{ url_for('admin_settings') }}" class="btn btn-sm me-1" aria-label="Admin Settings"><i class="fa-solid fa-gear"></i></a>
            {% endif %}
            <button id="logoutTopBtn" class="btn btn-sm" aria-label="Logout"><i class="fa-solid fa-sign-out-alt"></i></button>
        </div>
        <div class="container py-4">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <a href="/" class="back-link mb-0 d-inline-block"><i class="fa-solid fa-arrow-left"></i> Back to overview</a>
                <div></div>
            </div>
            <div class="stats-mini text-center">
                    <span class="me-3" title="Videos"><i class="icon fa-solid fa-film"></i> <span class="badge rounded-pill ms-1">{{ s_stats.videos }}</span></span>
                    <span class="me-3" title="Images"><i class="icon fa-solid fa-image"></i> <span class="badge rounded-pill ms-1">{{ s_stats.images }}</span></span>
                    <span class="me-3" title="Total duration"><i class="icon fa-solid fa-clock"></i> <span class="badge rounded-pill ms-1">{{ s_stats.duration_human }}</span></span>
                    <span class="" title="Total size"><i class="icon fa-solid fa-hard-drive"></i> <span class="badge rounded-pill ms-1">{{ s_stats.size_human }}</span></span>
                </div>
        <div class="liquid-glass">
                        <h2>{{ session.name }}<br><span class="fs-5 text-muted">{{ session.sub }}</span></h2>
            <div class="mb-3">
                <div class="d-flex flex-wrap align-items-center gap-2">
                                <strong>Tags:</strong>
                    <div id="tagList" class="d-flex flex-wrap">
                        {% if session.tags %}
                            {% for t in session.tags %}
                                <span class="badge rounded-pill text-bg-info tag-pill">#{{ t }}</span>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                {% if is_admin or can_edit_tags %}
                <div class="input-group mt-2" style="max-width:520px;">
                    <span class="input-group-text"><i class="fa-solid fa-hashtag"></i></span>
                    <input id="tagInput" type="text" class="form-control" placeholder="Enter tag (press Enter to add)">
                    <button id="saveTagsBtn" class="btn btn-outline-primary" type="button">Save all</button>
                </div>
                {% endif %}
                {% if is_admin or can_edit_tags %}
                <div class="form-text">Separate multiple tags with spaces or add them one by one.</div>
                {% endif %}
            </div>
            <div class="row g-4 mt-2">
                <div class="col-md-7">
                    {% if session.videos %}
                        <h5>Videos</h5>
                        {% if session.videos|length == 1 %}
                            <div class="d-flex justify-content-center">
                                <div class="video-container position-relative">
                                    <video class="media-thumb" src="/media/{{ session.videos[0] }}" controls></video>
                                                                        {% if is_admin or can_share %}
                                                                        <div class="position-absolute" style="top:10px; right:10px; display:flex; gap:6px;">
                                                                            <a class="btn btn-outline-secondary btn-sm" href="/download/{{ session.videos[0] }}" title="Download video">
                                                                                <i class="fa-solid fa-download"></i>
                                                                            </a>
                                                                            <button class="btn btn-outline-primary btn-sm share-btn"
                                                                                            data-video="{{ session.videos[0] }}"
                                                                                            title="Generate share link">
                                                                                    <i class="fa-solid fa-share-nodes"></i> Share
                                                                            </button>
                                                                        </div>
                                                                        {% endif %}
                                </div>
                            </div>
                        {% else %}
                            {% for v in session.videos %}
                                <div class="video-container position-relative d-inline-block">
                                    <video class="media-thumb" src="/media/{{ v }}" controls></video>
                                                                        {% if is_admin or can_share %}
                                                                        <div class="position-absolute" style="top:10px; right:10px; display:flex; gap:6px;">
                                                                            <a class="btn btn-outline-secondary btn-sm" href="/download/{{ v }}" title="Download video">
                                                                                <i class="fa-solid fa-download"></i>
                                                                            </a>
                                                                            <button class="btn btn-outline-primary btn-sm share-btn"
                                                                                            data-video="{{ v }}"
                                                                                            title="Generate share link">
                                                                                <i class="fa-solid fa-share-nodes"></i> Share
                                                                            </button>
                                                                        </div>
                                                                        {% endif %}
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endif %}
                    {% if session.images %}
                        <h5>Images</h5>
                        <div class="session-grid">
                            {% for img in session.images %}
                                <div class="image-card tcg-card">
                                    <div class="tcg-header">Image</div>
                                    <img class="image-thumb" src="/media/{{ img }}" alt="Bild" data-full="/media/{{ img }}">
                                    <div class="card-body">
                                        <div class="small text-muted">{{ img.split('/')[-1] }}</div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="col-md-5">
                    {% if session.logs %}
                        <h5>Logs</h5>
                        <ul class="list-group file-list mb-3">
                            {% for log in session.logs %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ log.split('/')[-1] }}
                                    <div>
                                        <a href="/download/{{ log }}" class="btn btn-sm btn-outline-secondary me-1"><i class="fa-solid fa-download"></i></a>
                                        {% if is_admin or can_edit_logs %}
                                        <button class="btn btn-sm btn-outline-primary view-log-btn" data-log="{{ log }}">View / Edit</button>
                                        {% endif %}
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    {% if session.blackbox %}
                        <h5>Blackbox logs</h5>
                        <ul class="list-group file-list mb-3">
                            {% for bb in session.blackbox %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ bb.split('/')[-1] }}
                                    <a href="/download/{{ bb }}" class="btn btn-sm btn-outline-secondary"><i class="fa-solid fa-download"></i></a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    {% if session.goggles %}
                        <h5>Goggles videos</h5>
                        <ul class="list-group file-list mb-3">
                            {% for g in session.goggles %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ g.split('/')[-1] }}
                                    <a href="/download/{{ g }}" class="btn btn-sm btn-outline-secondary"><i class="fa-solid fa-download"></i></a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    {% if session.meta %}
                        <h5>Metadata</h5>
                        <ul class="list-group file-list mb-3">
                            {% for m in session.meta %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ m.split('/')[-1] }}
                                    <a href="/download/{{ m }}" class="btn btn-sm btn-outline-secondary"><i class="fa-solid fa-download"></i></a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // initialize tooltips
        document.addEventListener('DOMContentLoaded', function(){
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (el) { return new bootstrap.Tooltip(el); });
        });
    </script>
    <script>
        // No more loading overlay - disabled completely
        document.addEventListener('DOMContentLoaded', function(){
            console.log('Session detail page loaded - no overlay');
        });
        (function(){
            const sess = encodeURIComponent("{{ session.name }}");
            const sub = encodeURIComponent("{{ session.sub }}");
            const endpoint = `/api/session/${sess}/${sub}/tags`;
            const input = document.getElementById('tagInput');
            const btn = document.getElementById('saveTagsBtn');
            const list = document.getElementById('tagList');
            function parseTags(str){
                return (str || '')
                    .split(/[ ,;]+/)
                    .map(s => s.trim())
                    .filter(Boolean);
            }
            function render(tags){
                list.innerHTML = '';
                tags.forEach(t => {
                    const span = document.createElement('span');
                    span.className = 'badge rounded-pill text-bg-info tag-pill';
                    span.textContent = '#' + t;
                    span.style.cursor = 'pointer';
                    span.title = 'Click to remove';
                    span.addEventListener('click', async () => {
                        const current = Array.from(list.querySelectorAll('.tag-pill')).map(x => x.textContent.replace(/^#/, '').toLowerCase());
                        const filtered = current.filter(x => x !== t);
                        await save(filtered);
                    });
                    list.appendChild(span);
                });
            }
            async function load(){
                try{
                    const res = await fetch(endpoint);
                    const data = await res.json();
                    render(data.tags || []);
                }catch{}
            }
            async function save(tags){
                // if no input/button present (user cannot edit), skip
                if (!btn || !input) return;
                const res = await fetch(endpoint, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({tags})});
                const data = await res.json();
                render(data.tags || []);
                input.value = '';
            }
            if (btn && input){
                btn.addEventListener('click', async () => {
                    const add = parseTags(input.value).map(x => x.toLowerCase());
                    const current = Array.from(list.querySelectorAll('.tag-pill')).map(x => x.textContent.replace(/^#/, '').toLowerCase());
                    const combined = Array.from(new Set(current.concat(add)));
                    await save(combined);
                });
                input.addEventListener('keydown', async (e) => {
                    if (e.key === 'Enter'){
                        const add = parseTags(input.value).map(x => x.toLowerCase());
                        if (add.length){
                            const current = Array.from(list.querySelectorAll('.tag-pill')).map(x => x.textContent.replace(/^#/, '').toLowerCase());
                            const combined = Array.from(new Set(current.concat(add)));
                            await save(combined);
                        }
                    }
                });
            }
            load();
        })();

        // Share Link System
        document.addEventListener('DOMContentLoaded', function() {
            const shareButtons = document.querySelectorAll('.share-btn');

            shareButtons.forEach(button => {
                button.addEventListener('click', async function() {
                    const videoPath = this.dataset.video;
                    const sessionName = "{{ session.name }}";
                    const sessionSub = "{{ session.sub }}";

                    // Show loading state
                    const originalContent = this.innerHTML;
                    this.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Creating...';
                    this.disabled = true;

                    try {
                        const response = await fetch('/api/generate-share-link', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                video_path: videoPath,
                                session_name: sessionName,
                                session_sub: sessionSub
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            showShareDialog(data.share_url, data.link_id);
                        } else {
                            const error = await response.json();
                            alert('Error generating share link: ' + (error.error || 'Unknown error'));
                        }
                    } catch (error) {
                        alert('Error generating share link: ' + error.message);
                    } finally {
                        // Restore button
                        this.innerHTML = originalContent;
                        this.disabled = false;
                    }
                });
            });

            function showShareDialog(shareUrl, linkId) {
                // Create modal dialog
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-content" style="background: rgba(15, 23, 42, 0.95); border: 1px solid rgba(255,255,255,0.1);">
                            <div class="modal-header border-bottom border-secondary">
                                <h5 class="modal-title text-light">Share Link Generated</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p class="text-light mb-3">Share this link to allow others to view the video:</p>
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" value="${shareUrl}" id="shareUrlInput" readonly
                                           style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                    <button class="btn btn-outline-primary" type="button" id="copyButton">
                                        <i class="fa-solid fa-copy"></i> Copy
                                    </button>
                                </div>
                                <div class="text-muted small">
                                    <i class="fa-solid fa-info-circle"></i>
                                    Link ID: <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">${linkId}</code>
                                </div>
                            </div>
                            <div class="modal-footer border-top border-secondary">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <a href="${shareUrl}" target="_blank" class="btn btn-primary">
                                    <i class="fa-solid fa-external-link-alt"></i> Test Link
                                </a>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Show modal
                const bootstrapModal = new bootstrap.Modal(modal);
                bootstrapModal.show();

                // Copy functionality
                modal.querySelector('#copyButton').addEventListener('click', function() {
                    const input = modal.querySelector('#shareUrlInput');
                    input.select();
                    navigator.clipboard.writeText(input.value).then(() => {
                        this.innerHTML = '<i class="fa-solid fa-check"></i> Copied!';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fa-solid fa-copy"></i> Copy';
                        }, 2000);
                    }).catch(() => {
                        // Fallback for older browsers
                        input.select();
                        document.execCommand('copy');
                        this.innerHTML = '<i class="fa-solid fa-check"></i> Copied!';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fa-solid fa-copy"></i> Copy';
                        }, 2000);
                    });
                });

                // Clean up modal when closed
                modal.addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modal);
                });
            }
        });
    </script>
    <script>
        // Fetch and optionally edit the primary session .txt log
        (function(){
            const canEdit = JSON.parse('{{ (is_admin or can_edit_logs) | tojson }}');
            document.addEventListener('click', async function(e){
                const btn = e.target.closest('.view-log-btn');
                if (!btn) return;
                const rel = btn.getAttribute('data-log');
                // derive session and sub from template vars
                const sessionName = encodeURIComponent("{{ session.name }}");
                const sessionSub = encodeURIComponent("{{ session.sub }}");
                const endpoint = `/api/session/${sessionName}/${sessionSub}/log`;
                // show loading modal
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="background: rgba(15, 23, 42, 0.95); border: 1px solid rgba(255,255,255,0.1); color:#e5eefb;">
                            <div class="modal-header border-bottom border-secondary">
                                <h5 class="modal-title">Session Log: ${rel.split('/').pop()}</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <textarea id="sessionLogTextarea" style="width:100%;height:360px;background:rgba(0,0,0,0.6);color:#e5eefb;border:1px solid rgba(255,255,255,0.08);padding:12px;">Loading...</textarea>
                            </div>
                            <div class="modal-footer border-top border-secondary">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                ${canEdit ? '<button id="saveSessionLogBtn" class="btn btn-primary">Save</button>' : ''}
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                try{
                    const res = await fetch(endpoint);
                    if (res.ok){
                        const data = await res.json();
                        const ta = modal.querySelector('#sessionLogTextarea');
                        ta.value = data.content || '';
                        if (!canEdit) ta.setAttribute('readonly','true');
                    } else {
                        const err = await res.json().catch(()=>({error:'unknown'}));
                        modal.querySelector('#sessionLogTextarea').value = 'Error loading log: ' + (err.error || 'unknown');
                    }
                }catch(err){
                    modal.querySelector('#sessionLogTextarea').value = 'Error: ' + err.message;
                }

                if (canEdit){
                    modal.querySelector('#saveSessionLogBtn').addEventListener('click', async function(){
                        const ta = modal.querySelector('#sessionLogTextarea');
                        const payload = { content: ta.value };
                        try{
                            const r = await fetch(endpoint, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
                            const j = await r.json();
                            if (r.ok){
                                // small success feedback
                                this.innerHTML = '<i class="fa-solid fa-check"></i> Saved';
                                setTimeout(()=> this.innerHTML = 'Save', 1600);
                            } else {
                                alert('Save failed: ' + (j.error || 'unknown'));
                            }
                        }catch(e){ alert('Save failed: ' + e.message); }
                    });
                }

                modal.addEventListener('hidden.bs.modal', function(){ document.body.removeChild(modal); });
            });
        })();
    </script>
    <script>
        // Top-right logout immediate (no confirm)
        (function(){
            const btn = document.getElementById('logoutTopBtn');
            if (!btn) return;
            btn.addEventListener('click', function(){
                fetch('/logout', {method:'GET', credentials:'same-origin'})
                    .finally(() => { window.location.href = '/login'; });
            });
        })();
    </script>
    <script>
        // Simple lightbox for gallery images
        (function(){
            function openLightbox(src){
                // create overlay
                const o = document.createElement('div');
                o.className = 'lightbox-overlay';
                const img = document.createElement('img');
                img.className = 'lightbox-img';
                img.src = src;
                o.appendChild(img);
                function close(){
                    if (o.parentNode) o.parentNode.removeChild(o);
                    document.removeEventListener('keydown', onKey);
                }
                function onKey(e){ if (e.key === 'Escape') close(); }
                o.addEventListener('click', close);
                img.addEventListener('click', close);
                document.addEventListener('keydown', onKey);
                document.body.appendChild(o);
            }
            document.addEventListener('click', function(e){
                const t = e.target;
                if (t && t.classList && t.classList.contains('image-thumb')){
                    const full = t.getAttribute('data-full') || t.src;
                    openLightbox(full);
                }
            }, false);
        })();
    </script>
                <div class="site-footer" style="position:fixed;left:12px;right:12px;bottom:10px;z-index:10000;font-size:0.85rem;color:rgba(226,232,240,0.95);pointer-events:none;display:flex;justify-content:space-between;align-items:center;">
            <div class="left">Created by <strong>NapoII</strong> — <a href="https://github.com/NapoII/FPVSessions" target="_blank" rel="noopener noreferrer" style="color:#a8d8ff;pointer-events:auto;">FPVSessions</a></div>
            <div class="right">© 2025 NapoII. All rights reserved.</div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function(){
                try{
                    const lo = document.getElementById('loadingOverlay');
                    if (lo){ lo.style.display='none'; lo.classList.add('hidden'); lo.style.pointerEvents='none'; }
                    const sf = document.querySelector('.site-footer'); if (sf){ sf.style.pointerEvents='none'; sf.style.zIndex='10000'; }
                    const top = document.querySelector('.top-logout'); if (top){ top.style.zIndex = '12000'; }
                }catch(e){ console.warn('cleanup failed', e); }
            });
        </script>
</body>
</html>
